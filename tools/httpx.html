<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>HTTPX JSON Viewer</title>
  <style>
    :root{--bg:#121212;--bg-alt:#181818;--surface:#1e1e1e;--surface-alt:#242424;--border:#333;--text:#e0e0e0;--text-muted:#aaa;--accent:#4da3ff;}
    *{box-sizing:border-box;}
    body{font-family:system-ui,Arial,sans-serif;background:var(--bg);color:var(--text);margin:0;padding:1rem;}
    h1{margin-top:0;color:var(--accent);}a{color:var(--accent);text-decoration:none;}a:hover{text-decoration:underline;}
    input[type=file],input[type=text],input[type=number]{padding:0.35rem 0.5rem;border:1px solid var(--border);border-radius:4px;background:var(--surface);color:var(--text);}input[type=file]{cursor:pointer;}input::placeholder{color:var(--text-muted);}input[type=checkbox]{accent-color:var(--accent);}
    .upload{margin:1rem 0;}
    .controls{display:flex;flex-wrap:wrap;gap:0.75rem;margin:1rem 0;}
    .controls>div{display:flex;flex-direction:column;font-size:0.85rem;}
    .controls label{margin-bottom:0.25rem;font-weight:600;color:var(--text);}    
    .status-group{display:flex;flex-wrap:wrap;gap:0.6rem;}
    .status-group label{font-weight:normal;display:flex;align-items:center;gap:0.15rem;color:var(--text);}    
    table{width:100%;border-collapse:collapse;background:var(--surface);border:1px solid var(--border);border-radius:4px;overflow:hidden;font-size:0.85rem;}
    thead{background:var(--surface-alt);}    
    th,td{padding:0.55rem 0.6rem;border-bottom:1px solid var(--border);text-align:left;vertical-align:top;}
    th{cursor:pointer;user-select:none;}
    tbody tr:nth-child(odd){background:var(--bg-alt);}    
    .footer{margin-top:0.5rem;font-size:0.85rem;color:var(--text-muted);}    
  </style>
</head>
<body>
  <h1>HTTPX JSON Viewer</h1>
  <p>Select a <strong>JSON</strong>/<strong>JSON Lines</strong> file exported from <code>httpx -json</code>. Filter and sort the results instantly.</p>

  <div class="upload">
    <input type="file" id="fileInput" accept=".json,.jsonl,.txt,application/json">
  </div>

  <div class="controls" style="display:none" id="filterBar">
    <div>
      <label for="search">Search URL / Host / Title</label>
      <input type="text" id="search" placeholder="substring…">
    </div>
    <div>
      <label>Status Codes</label>
      <div id="statusGroup" class="status-group">
        <label><input type="checkbox" value="200">200</label>
        <label><input type="checkbox" value="301">301</label>
        <label><input type="checkbox" value="302">302</label>
        <label><input type="checkbox" value="400">400</label>
        <label><input type="checkbox" value="401">401</label>
        <label><input type="checkbox" value="403">403</label>
        <label><input type="checkbox" value="404">404</label>
        <label><input type="checkbox" value="500">500</label>
      </div>
    </div>
    <div>
      <label for="clMin">Content Length ≥ (bytes)</label>
      <input type="number" id="clMin" placeholder="min">
    </div>
    <div>
      <label for="clMax">Content Length ≤ (bytes)</label>
      <input type="number" id="clMax" placeholder="max">
    </div>
    <div style="align-self:flex-end;display:flex;align-items:center;gap:0.3rem;">
      <input type="checkbox" id="hasTitle">
      <label for="hasTitle" style="margin:0;">With title only</label>
    </div>
  </div>

  <table id="table" style="display:none">
    <thead>
      <tr>
        <th data-col="status_code">Status</th>
        <th data-col="url">URL</th>
        <th data-col="title">Title</th>
        <th data-col="content_length">Content Length</th>
      </tr>
    </thead>
    <tbody id="tbody"></tbody>
  </table>

  <div class="footer"><span id="count">0</span> / <span id="total">0</span> rows</div>

<script>
  const dataStore=[];let sortCol=null;let sortDir=1; // 1 asc, -1 desc
  const tbody=document.getElementById('tbody');
  const filterBar=document.getElementById('filterBar');
  const table=document.getElementById('table');

  document.getElementById('fileInput').addEventListener('change',handleFile,false);

  function handleFile(e){const file=e.target.files[0];if(!file)return;const reader=new FileReader();reader.onload=ev=>processRaw(ev.target.result);reader.readAsText(file);} 

  function processRaw(raw){dataStore.length=0;raw=raw.trim();if(!raw)return;let arrayParsed=false;if(raw.startsWith('[')){
      try{const arr=JSON.parse(raw);if(Array.isArray(arr)){dataStore.push(...arr);arrayParsed=true;}}catch{}}
    if(!arrayParsed){raw.split(/\n/).forEach((line,i)=>{if(!line.trim())return;try{dataStore.push(JSON.parse(line));}catch(err){console.error(`Line ${i+1} invalid JSON`,err);}});} if(!dataStore.length){alert('No valid JSON records detected.');return;}
    document.getElementById('total').textContent=dataStore.length;
    filterBar.style.display='flex';table.style.display='table';attachSortHandlers();renderTable();}

  function attachSortHandlers(){document.querySelectorAll('th[data-col]').forEach(th=>{th.onclick=()=>{const col=th.getAttribute('data-col');if(sortCol===col){sortDir*=-1;}else{sortCol=col;sortDir=1;}renderTable();};});}

  function applyFilters(item){const q=document.getElementById('search').value.toLowerCase();const clMin=parseInt(document.getElementById('clMin').value,10);const clMax=parseInt(document.getElementById('clMax').value,10);const selStatuses=Array.from(document.querySelectorAll('#statusGroup input:checked')).map(cb=>cb.value);const onlyTitle=document.getElementById('hasTitle').checked;
    if(q&&!(item.url?.toLowerCase().includes(q)||item.input?.toLowerCase().includes(q)||item.title?.toLowerCase().includes(q)))return false;
    if(selStatuses.length&&!selStatuses.includes(String(item.status_code)))return false;
    const cl=parseInt(item.content_length??0,10);
    if(!isNaN(clMin)&&cl<clMin)return false;
    if(!isNaN(clMax)&&cl>clMax)return false;
    if(onlyTitle&&(!item.title||item.title.trim()===''))return false;
    return true;}

  function renderTable(){tbody.innerHTML='';let filtered=dataStore.filter(applyFilters); if(sortCol){filtered.sort((a,b)=>{let va=a[sortCol],vb=b[sortCol]; if(typeof va==='string')va=va.toLowerCase(); if(typeof vb==='string')vb=vb.toLowerCase(); if(va===undefined)va=''; if(vb===undefined)vb=''; return va<vb?-1*sortDir:va>vb?1*sortDir:0;});}
    filtered.forEach(it=>{const tr=document.createElement('tr');tr.innerHTML=`<td>${it.status_code??''}</td><td><a href="${it.url}" target="_blank" rel="noopener">${it.url}</a></td><td>${it.title??''}</td><td>${it.content_length??''}</td>`;tbody.appendChild(tr);});
    document.getElementById('count').textContent=filtered.length;}

  // filter listeners
  ['search','clMin','clMax','hasTitle'].forEach(id=>document.getElementById(id).addEventListener('input',renderTable));
  document.querySelectorAll('#statusGroup input').forEach(cb=>cb.addEventListener('change',renderTable));
</script>
</body>
</html>
